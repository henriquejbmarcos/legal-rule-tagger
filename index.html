<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Legal Rule Tagger</title>
  <style>
    body { margin: 0; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; background: #0b0f14; color: #e8edf3; }
    .panel { padding: 12px; box-sizing: border-box; border: 1px solid #2a3442; background: #121821; color: #e8edf3; margin-bottom: 12px; }
    #editor { border: 1px solid #2a3442; padding: 8px; min-height: 30vh; background: #0e141c; color: #e8edf3; }
    .toolbar { margin-bottom: 8px; }
    button { margin-right: 6px; background: #1b2430; color: #e8edf3; border: 1px solid #2a3442; padding: 6px 10px; border-radius: 6px; cursor: pointer; }
    button:hover { background: #273245; }
    .tag { padding: 0 .15em; border-radius: 4px; }
    .tag[data-tag="cumulative"] { background: #fef3c733; border: 1px solid #facc15; }
    .tag[data-tag="alternative"] { background: #fee2e233; border: 1px solid #f87171; }
    .tag[data-tag="consequence"] { background: #dbeafe33; border: 1px solid #60a5fa; }
    h3 { margin-top: 0; color: #7aa2ff; }
    .note-box { width: 100%; min-height: 60px; margin-top: 4px; background: #0e141c; color: #e8edf3; border: 1px solid #2a3442; border-radius: 6px; padding: 6px; }
    .item { margin: 4px 0; }
    @media print {
      body { background: white; color: black; display: block; }
      .toolbar, button { display: none !important; }
      .panel { border: none; background: white; color: black; page-break-inside: avoid; }
      #editor { border: 1px solid #000; background: white; color: black; min-height: auto; }
      .note-box { border: 1px solid #000; background: white; color: black; }
      /* Arrange vertically for print */
      #printWrapper { display: flex; flex-direction: column; }
    }
  </style>
</head>
<body>
  <!-- Toolbar -->
  <div class="toolbar">
    <button data-apply="cumulative">Cumulative Condition</button>
    <button data-apply="alternative">Alternative Condition</button>
    <button data-apply="consequence">Consequence</button>
    <button id="clearAll">Clear All</button>
    <button id="printPage">Print</button>
  </div>

  <div id="printWrapper">
    <!-- Editor on top -->
    <div class="panel">
      <div id="editor" contenteditable="true">
        <p><em>Paste your legal text here and highlight sections to tag.</em></p>
        <p><strong>Example:</strong> Every deficiency in the performance of an obligation obliges the debtor to compensate the creditor for the damage thereby caused to him, unless the deficiency cannot be attributed to the debtor.</p>
      </div>
    </div>

    <!-- Extracted tags vertically stacked -->
    <div class="panel" id="summary">
      <h3>Consequence</h3>
      <div id="consequenceList"></div>
      <textarea class="note-box" placeholder="Notes on consequence..."></textarea>
    </div>

    <div class="panel">
      <h3>Cumulative Conditions</h3>
      <div id="cumulativeList"></div>
      <textarea class="note-box" placeholder="Notes on cumulative conditions..."></textarea>
    </div>

    <div class="panel">
      <h3>Alternative Conditions</h3>
      <div id="alternativeList"></div>
      <textarea class="note-box" placeholder="Notes on alternative conditions..."></textarea>
    </div>
  </div>

  <script>
    const editor = document.getElementById('editor');
    const consequenceList = document.getElementById('consequenceList');
    const cumulativeList = document.getElementById('cumulativeList');
    const alternativeList = document.getElementById('alternativeList');

    function wrapSelection(tagType) {
      const sel = window.getSelection();
      if (!sel || sel.rangeCount === 0) return;
      const range = sel.getRangeAt(0);
      if (range.collapsed) return;

      const span = document.createElement('span');
      span.className = 'tag';
      span.setAttribute('data-tag', tagType);
      range.surroundContents(span);
      sel.removeAllRanges();
      updateSummary();
    }

    function clearAllTags() {
      editor.querySelectorAll('.tag').forEach(el => {
        const parent = el.parentNode;
        while (el.firstChild) parent.insertBefore(el.firstChild, el);
        el.remove();
      });
      updateSummary();
    }

    function updateSummary() {
      consequenceList.innerHTML = '';
      cumulativeList.innerHTML = '';
      alternativeList.innerHTML = '';
      let consequenceCount = 1;
      let cumulativeCount = 1;
      let alternativeCount = 1;
      editor.querySelectorAll('.tag').forEach(el => {
        const text = el.textContent.trim();
        const type = el.getAttribute('data-tag');
        const div = document.createElement('div');
        div.className = 'item';
        if (type === 'consequence') {
          div.textContent = consequenceCount + '. ' + text;
          consequenceList.appendChild(div);
          consequenceCount++;
        } else if (type === 'cumulative') {
          div.textContent = cumulativeCount + '. ' + text;
          cumulativeList.appendChild(div);
          cumulativeCount++;
        } else if (type === 'alternative') {
          const letter = String.fromCharCode(64 + alternativeCount); // A=65
          div.textContent = letter + '. ' + text;
          alternativeList.appendChild(div);
          alternativeCount++;
        }
      });
    }

    document.querySelectorAll('[data-apply]').forEach(btn => {
      btn.addEventListener('click', () => wrapSelection(btn.dataset.apply));
    });
    document.getElementById('clearAll').addEventListener('click', clearAllTags);
    document.getElementById('printPage').addEventListener('click', () => window.print());

    const obs = new MutationObserver(updateSummary);
    obs.observe(editor, { subtree: true, childList: true, characterData: true, attributes: true });
  </script>
</body>
</html>
